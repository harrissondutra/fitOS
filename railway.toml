[build]
builder = "nixpacks"
buildCommand = "npm run build:backend"
startCommand = "npm run start:backend"

[phases.setup]
nixPkgs = ["nodejs-20_x", "npm", "openssl"]

[phases.install]
cmds = ["npm install --include=dev"]

[phases.build]
cmds = [
    "cd src/backend && npx prisma generate",
    "npm run build:backend",
    "ls -R src/backend/dist || echo 'Dist folder missing details'"
]

[deploy]
healthCheckPath = "/api/health"
healthCheckTimeout = 100
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 10
